# Подключение к серверу по сети

## Обзор

В данной лабораторной работе реализованы два способа подключения клиента к серверу:
1. **Подключение по имени/IP-адресу** - прямое подключение по известному адресу
2. **Подключение по позывному** - поиск сервера в сети через UDP broadcast

---

## Способ 1: Подключение по имени/IP-адресу

### Настройка сервера

Сервер уже настроен для работы по сети. В файле `ConcurrentServer/AcceptServer.h` используется:
```cpp
Server_IN.sin_addr.s_addr = ADDR_ANY;  // Слушает на всех интерфейсах
```

Это означает, что сервер принимает подключения:
- С localhost (127.0.0.1)
- С любого сетевого интерфейса (локальная сеть, Wi-Fi и т.д.)

**Дополнительных настроек сервера не требуется!**

### Настройка клиента

1. Запустите клиент (`Client.exe`)
2. Выберите опцию **"1 - Подключение по имени сервера"**
3. Введите один из вариантов:
   - **IP-адрес сервера** (например: `192.168.1.100`)
   - **Имя хоста** (например: `DESKTOP-ABC123` или `server.local`)
   - **localhost** (для локального подключения: `127.0.0.1`)
4. Введите **TCP-порт** сервера (по умолчанию: `2000`)

### Пример подключения:
```
1 - Подключение по имени сервера
2 - Подключение по позывному
1
Введите имя сервера: 192.168.1.100
Порт сервера: 2000
```

---

## Способ 2: Подключение по позывному (UDP Broadcast)

### Принцип работы

Клиент отправляет UDP broadcast-запрос с позывным сервера. Сервер, услышав свой позывной, отвечает клиенту своим IP-адресом.

### Настройка сервера

Сервер уже настроен для работы по сети. В файле `ConcurrentServer/ResponseServer.h`:
```cpp
serv.sin_addr.s_addr = ADDR_ANY;  // Слушает на всех интерфейсах
```

**Дополнительных настроек не требуется!**

### Настройка клиента для сетевого подключения

**Важно:** По умолчанию клиент настроен на localhost. Для работы по сети нужно изменить адрес broadcast.

#### Вариант A: Использовать конкретный IP-адрес сети

В файле `Client/Client.cpp` найдите строку 160:
```cpp
all.sin_addr.s_addr = inet_addr("127.0.0.1"); //172.20.10.15
```

Измените на IP-адрес вашей сети. Например:
```cpp
all.sin_addr.s_addr = inet_addr("192.168.1.255");  // Broadcast адрес для сети 192.168.1.0/24
```

Или используйте конкретный IP-адрес сервера:
```cpp
all.sin_addr.s_addr = inet_addr("192.168.1.100");  // Прямой адрес сервера
```

#### Вариант B: Использовать широковещательный адрес (255.255.255.255)

Для поиска сервера во всей локальной сети:
```cpp
all.sin_addr.s_addr = INADDR_BROADCAST;  // 255.255.255.255
```

### Использование

1. Запустите клиент (`Client.exe`)
2. Выберите опцию **"2 - Подключение по позывному"**
3. Введите **позывной сервера** (по умолчанию: `HELLO`)
4. Введите **TCP-порт** сервера (по умолчанию: `2000`)

### Пример подключения:
```
1 - Подключение по имени сервера
2 - Подключение по позывному
2
Введите позывной сервера: HELLO
Порт сервера: 2000
```

---

## Определение IP-адреса сервера

### Windows

1. Откройте командную строку (cmd)
2. Выполните команду:
   ```cmd
   ipconfig
   ```
3. Найдите нужный интерфейс (Ethernet или Wi-Fi)
4. Используйте значение **IPv4 Address**

### Пример вывода:
```
Адаптер Ethernet Ethernet:
   IPv4-адрес. . . . . . . . . . . . : 192.168.1.100
   Маска подсети . . . . . . . . . . : 255.255.255.0
   Основной шлюз. . . . . . . . . . : 192.168.1.1
```

### Linux/Mac

```bash
ifconfig
# или
ip addr
```

---

## Определение broadcast-адреса

Broadcast-адрес вычисляется на основе IP-адреса и маски подсети.

### Формула:
```
broadcast = (IP & маска) | (~маска)
```

### Примеры:

| IP-адрес | Маска | Broadcast |
|----------|-------|-----------|
| 192.168.1.100 | 255.255.255.0 | 192.168.1.255 |
| 172.20.10.15 | 255.255.255.0 | 172.20.10.255 |
| 10.0.0.5 | 255.0.0.0 | 10.255.255.255 |

**Универсальный вариант:** Используйте `255.255.255.255` (INADDR_BROADCAST) для отправки на все интерфейсы.

---

## Проверка подключения

### Проверка доступности сервера

#### Windows:
```cmd
ping 192.168.1.100
```

#### Проверка порта:
```cmd
telnet 192.168.1.100 2000
```

### Проверка firewall

Убедитесь, что Windows Firewall разрешает подключения:
1. Откройте **Панель управления** → **Брандмауэр Windows**
2. Разрешите входящие подключения для порта 2000
3. Или временно отключите firewall для тестирования

---

## Типичные проблемы и решения

### Проблема: "Сервер не найден" при подключении по позывному

**Причины:**
- Неверный broadcast-адрес в клиенте
- Firewall блокирует UDP-пакеты
- Сервер не запущен
- Неверный позывной

**Решение:**
1. Проверьте, что сервер запущен
2. Убедитесь, что broadcast-адрес соответствует вашей сети
3. Проверьте firewall настройки
4. Проверьте позывной (по умолчанию: `HELLO`)

### Проблема: "Ошибка соединения" при подключении по IP

**Причины:**
- Неверный IP-адрес
- Неверный порт
- Firewall блокирует TCP-подключения
- Сервер не запущен

**Решение:**
1. Проверьте IP-адрес сервера командой `ipconfig`
2. Убедитесь, что порт совпадает (по умолчанию: 2000)
3. Проверьте firewall
4. Убедитесь, что сервер запущен и слушает на `ADDR_ANY`

### Проблема: Подключение работает только на localhost

**Причина:** Сервер слушает только на 127.0.0.1

**Решение:** Убедитесь, что в `AcceptServer.h` используется:
```cpp
Server_IN.sin_addr.s_addr = ADDR_ANY;  // НЕ inet_addr("127.0.0.1")
```

---

## Рекомендации

1. **Для локальной сети:** Используйте способ 1 (по IP-адресу) - он надёжнее
2. **Для поиска сервера:** Используйте способ 2 (по позывному) с правильным broadcast-адресом
3. **Для тестирования:** Сначала проверьте подключение на localhost (127.0.0.1)
4. **Для продакшена:** Настройте firewall правильно, не отключайте его полностью

---

## Пример полного сценария подключения по сети

### На сервере (192.168.1.100):
```cmd
ConcurrentServer.exe 2000 2000 Service_Library cpipe HELLO
```

### На клиенте (192.168.1.50):

**Вариант 1 - По IP:**
```
1 - Подключение по имени сервера
2 - Подключение по позывному
1
Введите имя сервера: 192.168.1.100
Порт сервера: 2000
```

**Вариант 2 - По позывному:**
(Предварительно измените в коде broadcast на `192.168.1.255`)
```
1 - Подключение по имени сервера
2 - Подключение по позывному
2
Введите позывной сервера: HELLO
Порт сервера: 2000
```

---

## Дополнительная информация

- **TCP-порт по умолчанию:** 2000
- **UDP-порт по умолчанию:** 2000
- **Позывной по умолчанию:** HELLO
- **ADDR_ANY (INADDR_ANY):** 0.0.0.0 - означает "слушать на всех интерфейсах"




