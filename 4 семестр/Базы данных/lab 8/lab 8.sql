-- Банковские реквизиты
CREATE TABLE Bank_Details (
    ID_банка INT AUTO_INCREMENT PRIMARY KEY,
    Название_банка VARCHAR(100) NOT NULL,
    БИК VARCHAR(20) NOT NULL,
    Корреспондентский_счет VARCHAR(20) NOT NULL,
    Расчетный_счет VARCHAR(20) NOT NULL UNIQUE,
    Валюта_счета VARCHAR(10) NOT NULL DEFAULT 'RUB',
    Дата_открытия DATE NOT NULL,
    CONSTRAINT unique_bank_account UNIQUE (БИК, Расчетный_счет)
);

-- Контактные лица
CREATE TABLE Contacts (
    ID_контакта INT AUTO_INCREMENT PRIMARY KEY,
    Фамилия VARCHAR(100) NOT NULL,
    Имя VARCHAR(100) NOT NULL,
    Отчество VARCHAR(100),
    Должность VARCHAR(100) NOT NULL,
    Телефон VARCHAR(20) NOT NULL UNIQUE,
    Email VARCHAR(100) UNIQUE,
    Дата_рождения DATE,
    Дата_найма DATE NOT NULL
);

-- Предприятия
CREATE TABLE Enterprises (
    ID_предприятия INT AUTO_INCREMENT PRIMARY KEY,
    Название_предприятия VARCHAR(255) NOT NULL,
    Юридический_адрес TEXT NOT NULL,
    Фактический_адрес TEXT,
    ИНН VARCHAR(12) NOT NULL UNIQUE,
    КПП VARCHAR(9) NOT NULL,
    ОГРН VARCHAR(15) NOT NULL UNIQUE,
    Дата_регистрации DATE NOT NULL,
    ID_банка INT,
    ID_контакта INT,
    FOREIGN KEY (ID_банка) REFERENCES Bank_Details(ID_банка),
    FOREIGN KEY (ID_контакта) REFERENCES Contacts(ID_контакта),
    INDEX (Название_предприятия),
    INDEX (ИНН)
);

-- Показатели
CREATE TABLE Indicators (
    ID_показателя INT AUTO_INCREMENT PRIMARY KEY,
    Название_показателя VARCHAR(255) NOT NULL UNIQUE,
    Описание TEXT,
    Единица_измерения VARCHAR(20) NOT NULL,
    Важность ENUM('Высокая', 'Средняя', 'Низкая') NOT NULL,
    Категория VARCHAR(100) NOT NULL,
    Минимальное_значение DECIMAL(15,2),
    Максимальное_значение DECIMAL(15,2),
    Дата_добавления DATE NOT NULL
);

-- Значения показателей
CREATE TABLE Indicator_Values (
    ID_значения INT AUTO_INCREMENT PRIMARY KEY,
    ID_показателя INT,
    ID_предприятия INT,
    Дата DATE NOT NULL,
    Значение DECIMAL(15,2) NOT NULL,
    Комментарий TEXT,
    Источник_данных VARCHAR(100) NOT NULL,
    Дата_добавления DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ID_показателя) REFERENCES Indicators(ID_показателя),
    FOREIGN KEY (ID_предприятия) REFERENCES Enterprises(ID_предприятия),
    UNIQUE KEY unique_indicator_entry (ID_показателя, ID_предприятия, Дата),
    INDEX (Дата)
);

-- Добавление банковских реквизитов
INSERT INTO Bank_Details (Название_банка, БИК, Корреспондентский_счет, Расчетный_счет, Валюта_счета, Дата_открытия) VALUES 
('Сбербанк', '044525225', '30101810400000000225', '40702810400000012345', 'RUB', '2020-01-15'),
('ВТБ', '044525187', '30101810700000000187', '40702810700000023456', 'RUB', '2019-05-20'),
('Альфа-Банк', '044525593', '30101810200000000593', '40702810200000034567', 'RUB', '2021-03-10'),
('Газпромбанк', '044525823', '30101810800000000823', '40702810800000045678', 'USD', '2018-11-05'),
('Тинькофф', '044525974', '30101810900000000974', '40702810900000056789', 'RUB', '2022-02-28'),
('Райффайзенбанк', '044525201', '30101810100000000201', '40702810100000067890', 'EUR', '2020-07-15'),
('Открытие', '044525111', '30101810500000000111', '40702810500000078901', 'RUB', '2019-09-01');

-- Добавление контактных лиц
INSERT INTO Contacts (Фамилия, Имя, Отчество, Должность, Телефон, Email, Дата_рождения, Дата_найма) VALUES 
('Иванов', 'Иван', 'Иванович', 'Генеральный директор', '+79161234567', 'ivanov@mail.com', '1980-05-15', '2015-06-10'),
('Петров', 'Петр', 'Петрович', 'Финансовый директор', '+79167654321', 'petrov@mail.com', '1975-08-20', '2016-03-15'),
('Сидорова', 'Мария', 'Сергеевна', 'Главный бухгалтер', '+79169876543', 'sidorova@mail.com', '1985-02-28', '2018-11-01'),
('Кузнецов', 'Алексей', 'Владимирович', 'Директор по развитию', '+79161112233', 'kuznetsov@mail.com', '1978-07-10', '2017-05-20'),
('Смирнова', 'Елена', 'Андреевна', 'Коммерческий директор', '+79163334455', 'smirnova@mail.com', '1982-11-25', '2019-02-15'),
('Васильев', 'Дмитрий', 'Олегович', 'Технический директор', '+79165556677', 'vasiliev@mail.com', '1973-04-05', '2014-08-01'),
('Николаева', 'Ольга', 'Игоревна', 'Директор по персоналу', '+79167778899', 'nikolaeva@mail.com', '1988-09-12', '2020-07-10');

-- Добавление предприятий
INSERT INTO Enterprises (Название_предприятия, Юридический_адрес, Фактический_адрес, ИНН, КПП, ОГРН, Дата_регистрации, ID_банка, ID_контакта) VALUES 
('ООО "Альфа"', 'г. Москва, ул. Ленина, д. 1', 'г. Москва, ул. Ленина, д. 1, оф. 101', '7701123456', '770101001', '1157746123456', '2015-01-20', 1, 1),
('ЗАО "Бета"', 'г. Санкт-Петербург, Невский пр-т, д. 10', 'г. Санкт-Петербург, Невский пр-т, д. 10, оф. 5', '7802987654', '780201001', '1157846987654', '2016-03-15', 2, 2),
('ООО "Гамма"', 'г. Екатеринбург, ул. Малышева, д. 25', 'г. Екатеринбург, ул. Малышева, д. 25, оф. 30', '6605123456', '660501001', '1167746123456', '2017-05-10', 3, 3),
('АО "Дельта"', 'г. Новосибирск, ул. Кирова, д. 15', 'г. Новосибирск, ул. Кирова, д. 15, оф. 12', '5406987654', '540601001', '1177846987654', '2018-07-20', 4, 4),
('ООО "Эпсилон"', 'г. Казань, ул. Баумана, д. 5', 'г. Казань, ул. Баумана, д. 5, оф. 8', '1605123456', '160501001', '1187746123456', '2019-09-05', 5, 5),
('ПАО "Зета"', 'г. Сочи, ул. Навагинская, д. 7', 'г. Сочи, ул. Навагинская, д. 7, оф. 3', '2306987654', '230601001', '1197846987654', '2020-11-15', 6, 6),
('ООО "Эта"', 'г. Владивосток, ул. Светланская, д. 20', 'г. Владивосток, ул. Светланская, д. 20, оф. 15', '2505123456', '250501001', '1207746123456', '2021-01-30', 7, 7);

-- Добавление показателей
INSERT INTO Indicators (Название_показателя, Описание, Единица_измерения, Важность, Категория, Минимальное_значение, Максимальное_значение, Дата_добавления) VALUES 
('Прибыль', 'Чистая прибыль за период', 'руб.', 'Высокая', 'Финансы', NULL, NULL, '2020-01-01'),
('Себестоимость', 'Полная себестоимость продукции', 'руб.', 'Средняя', 'Финансы', NULL, NULL, '2020-01-01'),
('Выручка', 'Объем продаж', 'руб.', 'Высокая', 'Финансы', 0, NULL, '2020-01-01'),
('ROE', 'Рентабельность собственного капитала', '%', 'Высокая', 'Финансы', NULL, NULL, '2020-02-15'),
('ROA', 'Рентабельность активов', '%', 'Средняя', 'Финансы', NULL, NULL, '2020-02-15'),
('Численность персонала', 'Среднесписочная численность', 'чел.', 'Средняя', 'Персонал', 1, NULL, '2020-03-10'),
('ФОТ', 'Фонд оплаты труда', 'руб.', 'Средняя', 'Персонал', NULL, NULL, '2020-03-10'),
('Производительность труда', 'Выручка на 1 сотрудника', 'руб./чел.', 'Низкая', 'Персонал', NULL, NULL, '2020-04-05'),
('Оборачиваемость дебиторки', 'Средний срок погашения ДЗ', 'дн.', 'Средняя', 'Финансы', NULL, 90, '2020-05-20'),
('Оборачиваемость кредиторки', 'Средний срок погашения КЗ', 'дн.', 'Средняя', 'Финансы', NULL, 90, '2020-05-20');

-- Добавление значений показателей (по 10 записей для каждого предприятия)
-- ООО "Альфа"
INSERT INTO Indicator_Values (ID_показателя, ID_предприятия, Дата, Значение, Комментарий, Источник_данных) VALUES 
(1, 1, '2023-01-01', 1500000.00, 'Годовой отчет', 'Бухгалтерия'),
(2, 1, '2023-01-01', 8500000.00, 'Годовой отчет', 'Бухгалтерия'),
(3, 1, '2023-01-01', 10000000.00, 'Годовой отчет', 'Бухгалтерия'),
(4, 1, '2023-01-01', 18.50, 'Расчетный показатель', 'Финансовый отдел'),
(5, 1, '2023-01-01', 12.30, 'Расчетный показатель', 'Финансовый отдел'),
(6, 1, '2023-01-01', 45.00, 'Среднегодовая', 'Отдел кадров'),
(7, 1, '2023-01-01', 5400000.00, 'Годовой ФОТ', 'Бухгалтерия'),
(8, 1, '2023-01-01', 222222.22, 'Расчетный показатель', 'Финансовый отдел'),
(9, 1, '2023-01-01', 35.00, 'Средний показатель', 'Бухгалтерия'),
(10, 1, '2023-01-01', 40.00, 'Средний показатель', 'Бухгалтерия'),
(1, 1, '2023-02-01', 125000.00, 'Ежемесячный отчет', 'Бухгалтерия'),
(3, 1, '2023-02-01', 850000.00, 'Ежемесячный отчет', 'Бухгалтерия');

-- ЗАО "Бета"
INSERT INTO Indicator_Values (ID_показателя, ID_предприятия, Дата, Значение, Комментарий, Источник_данных) VALUES 
(1, 2, '2023-01-01', 2500000.00, 'Годовой отчет', 'Бухгалтерия'),
(2, 2, '2023-01-01', 12000000.00, 'Годовой отчет', 'Бухгалтерия'),
(3, 2, '2023-01-01', 14500000.00, 'Годовой отчет', 'Бухгалтерия'),
(4, 2, '2023-01-01', 22.10, 'Расчетный показатель', 'Финансовый отдел'),
(5, 2, '2023-01-01', 15.75, 'Расчетный показатель', 'Финансовый отдел'),
(6, 2, '2023-01-01', 68.00, 'Среднегодовая', 'Отдел кадров'),
(7, 2, '2023-01-01', 8160000.00, 'Годовой ФОТ', 'Бухгалтерия'),
(8, 2, '2023-01-01', 213235.29, 'Расчетный показатель', 'Финансовый отдел'),
(9, 2, '2023-01-01', 28.00, 'Средний показатель', 'Бухгалтерия'),
(10, 2, '2023-01-01', 32.00, 'Средний показатель', 'Бухгалтерия'),
(1, 2, '2023-02-01', 210000.00, 'Ежемесячный отчет', 'Бухгалтерия'),
(3, 2, '2023-02-01', 1200000.00, 'Ежемесячный отчет', 'Бухгалтерия');

-- ООО "Гамма"
INSERT INTO Indicator_Values (ID_показателя, ID_предприятия, Дата, Значение, Комментарий, Источник_данных) VALUES 
(1, 3, '2023-01-01', 3200000.00, 'Годовой отчет', 'Бухгалтерия'),
(2, 3, '2023-01-01', 15000000.00, 'Годовой отчет', 'Бухгалтерия'),
(3, 3, '2023-01-01', 18200000.00, 'Годовой отчет', 'Бухгалтерия'),
(4, 3, '2023-01-01', 25.30, 'Расчетный показатель', 'Финансовый отдел'),
(5, 3, '2023-01-01', 18.20, 'Расчетный показатель', 'Финансовый отдел'),
(6, 3, '2023-01-01', 92.00, 'Среднегодовая', 'Отдел кадров'),
(7, 3, '2023-01-01', 11040000.00, 'Годовой ФОТ', 'Бухгалтерия'),
(8, 3, '2023-01-01', 197826.09, 'Расчетный показатель', 'Финансовый отдел'),
(9, 3, '2023-01-01', 22.00, 'Средний показатель', 'Бухгалтерия'),
(10, 3, '2023-01-01', 25.00, 'Средний показатель', 'Бухгалтерия'),
(1, 3, '2023-02-01', 280000.00, 'Ежемесячный отчет', 'Бухгалтерия'),
(3, 3, '2023-02-01', 1500000.00, 'Ежемесячный отчет', 'Бухгалтерия');

-- АО "Дельта"
INSERT INTO Indicator_Values (ID_показателя, ID_предприятия, Дата, Значение, Комментарий, Источник_данных) VALUES 
(1, 4, '2023-01-01', 4200000.00, 'Годовой отчет', 'Бухгалтерия'),
(2, 4, '2023-01-01', 18000000.00, 'Годовой отчет', 'Бухгалтерия'),
(3, 4, '2023-01-01', 22200000.00, 'Годовой отчет', 'Бухгалтерия'),
(4, 4, '2023-01-01', 28.75, 'Расчетный показатель', 'Финансовый отдел'),
(5, 4, '2023-01-01', 21.40, 'Расчетный показатель', 'Финансовый отдел'),
(6, 4, '2023-01-01', 115.00, 'Среднегодовая', 'Отдел кадров'),
(7, 4, '2023-01-01', 13800000.00, 'Годовой ФОТ', 'Бухгалтерия'),
(8, 4, '2023-01-01', 193043.48, 'Расчетный показатель', 'Финансовый отдел'),
(9, 4, '2023-01-01', 18.00, 'Средний показатель', 'Бухгалтерия'),
(10, 4, '2023-01-01', 20.00, 'Средний показатель', 'Бухгалтерия'),
(1, 4, '2023-02-01', 350000.00, 'Ежемесячный отчет', 'Бухгалтерия'),
(3, 4, '2023-02-01', 1850000.00, 'Ежемесячный отчет', 'Бухгалтерия');

-- ООО "Эпсилон"
INSERT INTO Indicator_Values (ID_показателя, ID_предприятия, Дата, Значение, Комментарий, Источник_данных) VALUES 
(1, 5, '2023-01-01', 3800000.00, 'Годовой отчет', 'Бухгалтерия'),
(2, 5, '2023-01-01', 16000000.00, 'Годовой отчет', 'Бухгалтерия'),
(3, 5, '2023-01-01', 19800000.00, 'Годовой отчет', 'Бухгалтерия'),
(4, 5, '2023-01-01', 26.80, 'Расчетный показатель', 'Финансовый отдел'),
(5, 5, '2023-01-01', 19.60, 'Расчетный показатель', 'Финансовый отдел'),
(6, 5, '2023-01-01', 105.00, 'Среднегодовая', 'Отдел кадров'),
(7, 5, '2023-01-01', 12600000.00, 'Годовой ФОТ', 'Бухгалтерия'),
(8, 5, '2023-01-01', 188571.43, 'Расчетный показатель', 'Финансовый отдел'),
(9, 5, '2023-01-01', 20.00, 'Средний показатель', 'Бухгалтерия'),
(10, 5, '2023-01-01', 22.00, 'Средний показатель', 'Бухгалтерия'),
(1, 5, '2023-02-01', 320000.00, 'Ежемесячный отчет', 'Бухгалтерия'),
(3, 5, '2023-02-01', 1650000.00, 'Ежемесячный отчет', 'Бухгалтерия');

-- ПАО "Зета"
INSERT INTO Indicator_Values (ID_показателя, ID_предприятия, Дата, Значение, Комментарий, Источник_данных) VALUES 
(1, 6, '2023-01-01', 4800000.00, 'Годовой отчет', 'Бухгалтерия'),
(2, 6, '2023-01-01', 20000000.00, 'Годовой отчет', 'Бухгалтерия'),
(3, 6, '2023-01-01', 24800000.00, 'Годовой отчет', 'Бухгалтерия'),
(4, 6, '2023-01-01', 31.20, 'Расчетный показатель', 'Финансовый отдел'),
(5, 6, '2023-01-01', 23.10, 'Расчетный показатель', 'Финансовый отдел'),
(6, 6, '2023-01-01', 128.00, 'Среднегодовая', 'Отдел кадров'),
(7, 6, '2023-01-01', 15360000.00, 'Годовой ФОТ', 'Бухгалтерия'),
(8, 6, '2023-01-01', 193750.00, 'Расчетный показатель', 'Финансовый отдел'),
(9, 6, '2023-01-01', 15.00, 'Средний показатель', 'Бухгалтерия'),
(10, 6, '2023-01-01', 18.00, 'Средний показатель', 'Бухгалтерия'),
(1, 6, '2023-02-01', 400000.00, 'Ежемесячный отчет', 'Бухгалтерия'),
(3, 6, '2023-02-01', 2050000.00, 'Ежемесячный отчет', 'Бухгалтерия');

-- ООО "Эта"
INSERT INTO Indicator_Values (ID_показателя, ID_предприятия, Дата, Значение, Комментарий, Источник_данных) VALUES 
(1, 7, '2023-01-01', 2900000.00, 'Годовой отчет', 'Бухгалтерия'),
(2, 7, '2023-01-01', 14000000.00, 'Годовой отчет', 'Бухгалтерия'),
(3, 7, '2023-01-01', 16900000.00, 'Годовой отчет', 'Бухгалтерия'),
(4, 7, '2023-01-01', 24.10, 'Расчетный показатель', 'Финансовый отдел'),
(5, 7, '2023-01-01', 17.80, 'Расчетный показатель', 'Финансовый отдел'),
(6, 7, '2023-01-01', 88.00, 'Среднегодовая', 'Отдел кадров'),
(7, 7, '2023-01-01', 10560000.00, 'Годовой ФОТ', 'Бухгалтерия'),
(8, 7, '2023-01-01', 192045.45, 'Расчетный показатель', 'Финансовый отдел'),
(9, 7, '2023-01-01', 25.00, 'Средний показатель', 'Бухгалтерия'),
(10, 7, '2023-01-01', 28.00, 'Средний показатель', 'Бухгалтерия'),
(1, 7, '2023-02-01', 240000.00, 'Ежемесячный отчет', 'Бухгалтерия'),
(3, 7, '2023-02-01', 1400000.00, 'Ежемесячный отчет', 'Бухгалтерия');














CREATE VIEW Банк AS
SELECT 
    ID_банка AS Код_банка,
    Название_банка AS Имя_банка,
    БИК AS БИК_банка,
    Расчетный_счет AS Расчетный_счет
FROM Bank_Details;

CREATE VIEW Количество_контактов AS
SELECT 
    e.Название_предприятия AS Название,
    COUNT(c.ID_контакта) AS Количество_контактов
FROM Enterprises e
LEFT JOIN Contacts c ON e.ID_предприятия = c.ID_контакта
GROUP BY e.Название_предприятия;

CREATE VIEW Высокие_показатели AS
SELECT 
    ID_значения AS Код_записи,
    ID_показателя AS Код_показателя,
    Значение AS Значение_показателя
FROM Indicator_Values
WHERE Значение > 3000
WITH CHECK OPTION;

INSERT INTO Высокие_показатели VALUES (84, 2, 4500);

UPDATE Высокие_показатели
SET Значение_показателя = 5500
WHERE Код_записи = 3;

DELETE FROM Высокие_показатели
WHERE Код_записи = 83;


CREATE VIEW Показатели_на_Ф AS
SELECT 
    ID_показателя AS Код_показателя,
    Название_показателя AS Название_показателя
FROM Indicators
WHERE Название_показателя LIKE 'Ф%';

CREATE VIEW Первые_10_показателей AS
SELECT 
    ID_показателя AS Код_показателя,
    Название_показателя AS Название_показателя,
    Единица_измерения AS Единица_измерения
FROM Indicators
ORDER BY Название_показателя
LIMIT 10;

CREATE OR REPLACE VIEW Высокие_показатели AS
SELECT 
    ID_значения AS Код_записи,
    ID_показателя AS Код_показателя,
    Значение AS Значение_показателя
FROM Indicator_Values;


INSERT INTO Высокие_показатели (Код_записи, Код_показателя, Значение_показателя)
VALUES (84, 2, 4500);
